{"ast":null,"code":"import _objectSpread from\"C:/Users/i7/Desktop/ReactWeb/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"C:/Users/i7/Desktop/ReactWeb/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"C:/Users/i7/Desktop/ReactWeb/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/i7/Desktop/ReactWeb/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/i7/Desktop/ReactWeb/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useState,useEffect}from'react';import axios from'axios';function UserApi(token){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isLogged=_useState2[0],setIsLogged=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),isAdmin=_useState4[0],setIsAdmin=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),cart=_useState6[0],setCart=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),user=_useState8[0],setUser=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),history=_useState10[0],setHistory=_useState10[1];useEffect(function(){if(token){var getUser=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return axios.get('/api/user/getUser',{headers:{Authorization:token}});case 3:res=_context.sent;setIsLogged(true);setUser(res.data._id);res.data.role===1?setIsAdmin(true):setIsAdmin(false);setCart(res.data.cart);_context.next=13;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](0);alert(_context.t0.response.data.msg);case 13:case\"end\":return _context.stop();}}},_callee,null,[[0,10]]);}));return function getUser(){return _ref.apply(this,arguments);};}();getUser();}},[token]);useEffect(function(){if(token){var gethistory=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return axios.get('https://kinaon.herokuapp.com/api/user/history',{headers:{Authorization:token}});case 2:res=_context2.sent;setHistory(res.data);console.log(res);case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function gethistory(){return _ref2.apply(this,arguments);};}();gethistory();}},[token]);var addCart=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(product){var check;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(isLogged){_context3.next=2;break;}return _context3.abrupt(\"return\",alert(\"Please login to continue buying\"));case 2:check=cart.every(function(item){return item._id!==product._id;});if(!check){_context3.next=9;break;}setCart([].concat(_toConsumableArray(cart),[_objectSpread(_objectSpread({},product),{},{quantity:1})]));_context3.next=7;return axios.patch('https://kinaon.herokuapp.com/api/user/addcart',{user:user,cart:[].concat(_toConsumableArray(cart),[_objectSpread(_objectSpread({},product),{},{quantity:1})])},{headers:{Authorization:token}});case 7:_context3.next=10;break;case 9:alert(\"This product has been added to cart.\");case 10:case\"end\":return _context3.stop();}}},_callee3);}));return function addCart(_x){return _ref3.apply(this,arguments);};}();return{isLogged:[isLogged,setIsLogged],isAdmin:[isAdmin,setIsAdmin],cart:[cart,setCart],addCart:addCart,user:[user,setUser],history:[history,setHistory]};}export default UserApi;","map":{"version":3,"sources":["C:/Users/i7/Desktop/ReactWeb/client/src/api/UserApi.js"],"names":["useState","useEffect","axios","UserApi","token","isLogged","setIsLogged","isAdmin","setIsAdmin","cart","setCart","user","setUser","history","setHistory","getUser","get","headers","Authorization","res","data","_id","role","alert","response","msg","gethistory","console","log","addCart","product","check","every","item","quantity","patch"],"mappings":"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","sourcesContent":["import {useState, useEffect} from 'react'\r\nimport axios from 'axios'\r\n\r\nfunction UserApi(token) {\r\n    const [isLogged, setIsLogged] = useState(false)\r\n    const [isAdmin, setIsAdmin] = useState(false)\r\n    const [cart, setCart] = useState([])\r\n    const [user, setUser] =useState('')\r\n    const [history, setHistory] = useState([])\r\n\r\n    useEffect(() =>{\r\n        if(token){\r\n            const getUser = async () =>{\r\n                try {\r\n                    const res = await axios.get('/api/user/getUser', {\r\n                        headers: {Authorization: token}\r\n                    })\r\n                    setIsLogged(true)\r\n                    setUser(res.data._id)\r\n                    res.data.role === 1 ? setIsAdmin(true) : setIsAdmin(false)\r\n\r\n                    setCart(res.data.cart)\r\n\r\n                } catch (err) {\r\n                    alert(err.response.data.msg)\r\n                }\r\n            }\r\n\r\n            getUser()\r\n            \r\n        }\r\n    },[token])\r\n\r\n    \r\n    useEffect(() => {\r\n        if(token){\r\n            const gethistory = async() =>{\r\n                const res = await axios.get('https://kinaon.herokuapp.com/api/user/history', {\r\n                    headers:{Authorization:token}\r\n                })\r\n                setHistory(res.data)\r\n                console.log(res);\r\n            }\r\n            gethistory()\r\n        }\r\n    },[token])\r\n    \r\n\r\n    const addCart = async (product) => {\r\n        if(!isLogged) return alert(\"Please login to continue buying\")\r\n\r\n        const check = cart.every(item =>{\r\n            return item._id !== product._id\r\n        })\r\n\r\n        if(check){\r\n            setCart([...cart, {...product, quantity: 1}])\r\n\r\n            await axios.patch('https://kinaon.herokuapp.com/api/user/addcart', {user:user, cart: [...cart, {...product, quantity: 1}]}, {\r\n                headers: {Authorization: token}\r\n            })\r\n\r\n\r\n        }else{\r\n            alert(\"This product has been added to cart.\")\r\n        }\r\n    }\r\n\r\n    return {\r\n        isLogged: [isLogged, setIsLogged],\r\n        isAdmin: [isAdmin, setIsAdmin],\r\n        cart: [cart, setCart],\r\n        addCart: addCart,\r\n        user : [user, setUser],\r\n        history: [history, setHistory]\r\n    }\r\n}\r\n\r\nexport default UserApi"]},"metadata":{},"sourceType":"module"}